<?php
	session_start();
	date_default_timezone_set('Asia/Shanghai');
	include '../php/second_hand.php';
	include '../php/db_helper.php';
?>

<!DOCTYPE html>
<html lang="zh-CN">
<head> 
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>南宫水塔-留学生服务平台</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
	<!-- Ajax API -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

	<link rel="stylesheet" href="../css/header.css">
	<!-- 填写物品form的小窗口 -->
	<link rel="stylesheet" href="../css/item_input.css">
	<!-- 上传（物品图片）按钮设计 -->
	<link rel="stylesheet" href="../css/image_upload.css">

	<style>
		.community{
			margin-top: 40px;
			padding: 0px;
		}
		.my_community_histoty{
			margin-top: 20px;
			margin-left: 0px;
			margin-right: 0px;
			padding-left: 0px;
			
        }
		
		/* 二手table */
        * {
            box-sizing: border-box;
        }
        .column {
            float: left;
            width: 30%;
            padding: 0px;
            margin: 6px;
			border-radius: 12px;
			background-color: #f3f3f3;
        }
        .row:after {
            content: "";
            display: table;
            clear: both;
        }
        .center {
            display: block;
            margin-left: auto;
            margin-right: auto;
            width: 120px;
            height: 120px;
            object-fit: cover;
		}
		.item-img {
			height: 160px; 
			width: 100%; 
			border-top-left-radius: 12px;
			border-top-right-radius: 12px;
		}
        .item-desc {
			float: left;
            padding: 10px;
            margin: 6px;
		}
		
		.column-input {
			float: left;
			width: 33.3%;
			/* margin-right: 10px; */
		}

		.row-input:after {
			content: "";
			display: table;
			clear: both;
		}
	</style>
</head>

<body>

<!-- 
	注意：虽然发现有6个错误，请不要删或改那代码 不然这网页不能运行。
 -->

<!--头部一-------------------------------------------------------------------------------------------------->
	<div class="container">
		<div class="row">
			<!--网页logo-->
			<div class="col-lg-7 col-md-5 col-sm-6 col-xs-4">
				<img src="../img/logo.jpg" id="logo" alt="logo">
			</div>
			<!--搜索框search---><!---
			<div class="col-lg-3 col-md-3 col-sm-3 col-xs-8 header_elements">
				<form class="navbar-form" action="" >
					<div class="input-group ">
						<input type="text" class="form-control" placeholder="Search for...">
						<span class="input-group-btn">
							<button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-search"></span></button>
						</span>
					</div>
				</form>
			</div>-->
			<!--登录注册按钮login-->
			<div class="col-lg-2 col-md-3 col-sm-2 header_elements">
				<?php
				if (isset($_SESSION['uId'])) {
					echo '<a class="btn btn-primary" href="../php/logout_inc.php" role="button" id="glyphicon-user">退出</a>';
					echo "<a style='color: steelblue; font-weight: bold;'> Hi, ".$_SESSION['uName']."</a>";
				}
				else {
					echo '<button type="button" class="btn btn-primary" id="glyphicon-user"><span class="glyphicon glyphicon-user"></span></button>';
					echo '<a href="../index/login.html"> 登录</a> / <a href="../index/register.html">注册</a></p>';
				}
				?>
			</div>
			<!-- <div class="col-lg-2 col-md-3 col-sm-2  header_elements">
				<button class="btn btn-primary" id="glyphicon-user"><span class="glyphicon glyphicon-user"></span></button>
				<p class="header-text"><a href="">登录</a> / <a href="">注册</a></p>
			</div> -->
			<!--语言选择按钮language--->	
			<div class="col-lg-3 col-md-4 col-sm-4  header_elements">
				<button class="btn btn-primary" id="glyphicon-flag"><span class="glyphicon glyphicon-flag"></span></button>
				<p class="header-text"><a href="" class="active">中文</a> / <a href="">English</a> / <a href="">Français</a></p>
			</div>
		</div>
	</div>
<!--头部二-------------------------------------------------------------------------------------------------->
	<div class="container">
		<div class="row">
			<ul class="nav nav-pills nav-justified">
				<li><a href="index.html"><span class="glyphicon glyphicon-home"></span> 主页</a></li>
				<li class="active"><a href="2_Application.html"><span class="glyphicon glyphicon-phone-alt"></span> 留学生一站式生活服务平台</a></li>
				<li><a href="2_Application.html"><span class="glyphicon glyphicon-send"></span> 留学生申请资讯平台</a></li>
				<li><a href="3_OrganizeActivity.html"><span class="glyphicon glyphicon-transfer"></span> 留学生线下活动协办平台</a></li>
			</ul>
		</div>
	</div>
	<hr>
<!--头部三--------------------------------------------------------------------------------------------->
	<div class="container">
		<div class="row">
			<ul class="nav nav-pills nav-justified">
				<li><a href="1_life.html"><span class=""></span>课程查询</a></li>
				<li class="active"><a href="1_life_2.html"><span class=""></span>生活社区</a></li>
				<li><a href="1_life_3.html"><span class=""></span>知识学堂</a></li>
			</ul>
		</div>
	</div>
<!-------------------------------------------------------------------------------------------------------->
	<div class="container community">
		<div class="col-md-2">
			<ul class="nav nav-pills nav-stacked">
				<?php
					if (isset($_SESSION['uId'])) {
						echo '<li><a style="color: steelblue; font-weight: bold;"> Hi, '.$_SESSION['uName'].'</a></li>';
					}
					else {
						echo '<li><a href=""><span class=""></span>您未登录哟~</a></li>';
					}
				?>
				<!-- <li><a href=""><span class=""></span>昵称</a></li> -->
				<li><a href="1_life_2.html"><span class=""></span>我的主页</a></li>
				<li><a href="1_life_2_2.html"><span class=""></span>生活分享</a></li>
				<li class="active"><a href="1_life_2_3.html"><span class="active"></span>二手交易</a></li>
				<li><a href=""><span class=""></span>快递代取</a></li>
			</ul>
		</div>
		<!-- echo '<button onclick="document.getElementById(\'add_product\')" type="button" class="btn btn-primary" id="add_product" style="float: right;"><span class="glyphicon glyphicon-plus"></span></button>'; -->
		<div class="col-md-1"></div>
		<div class="col-md-8 my_community_index">
			<div class="row">
				<?php
				if (isset($_SESSION['uName'])) {
					echo '<button type="button" class="btn btn-primary" id="glyphicon-user"><span class="glyphicon glyphicon-user"></span></button>';
					echo '<a class="btn btn-info" onclick="document.getElementById(\'add_product\').style.display=\'block\'" role="button" id="glyphicon-user" style="float: right;">卖物品</a>';
					echo "<a style='color: steelblue; font-weight: bold;'> ".$_SESSION['uName']."</a>";
					echo '<p></p>';
					echo '<div class="dropdown">
						<a id="showMode" type="button" class="btn btn-info dropdown-toggle btn-s" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">查看
						<span class="caret"></span>
						</a>
						<ul class="dropdown-menu" aria-labelledby="showMode" style="padding: 6px">
							<a type="button" onclick="" style="font-weight: bold;">我的</a>
							<p></p>
							<a type="button" onclick="" style="font-weight: bold;">全部</a>
						</ul>
					</div>';
					echo '<div id="add_product" class="modal">
						<form class="modal-content animate" action="../php/second_hand.php" method="POST" enctype="multipart/form-data">
							<div class="img-container">
								<!-- <span onclick="(document.getElementById(\"add_product\").style.display=\'none\')" class="close" title="关闭">&times;</span> -->
								<br>
								<label for="iimg"><b>物品图片</b></label>
								<br>
								<!-- <input type="file" name="imgupload" id="selectfile" class="choose_file_btn style-2" data-multiple-caption="{count} files selected" multiple> -->
								<input type="file" name="imgupload" id="selectfile" class="choose_file_btn style-2" required>
								<label for="selectfile"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="17" viewBox="0 0 20 17"><path d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"/></svg> <span>选择图片&hellip;</span></label>
								<!-- <div id="drop_file_zone" ondrop="upload_file(event)" ondragover="return false">
									<div id="drag_upload_file">
										<p>将物品图片放到此处</p>
										<p>或</p>
										<p><input type="button" class="choose_file_btn" value="选择图像" name="imgupload" onclick="file_explorer();"></p>
										<input type="file" id="selectfile" name="imgupload" required>
									</div>
								</div> -->
							</div>
							<input type="hidden" name="sname" value="'.$_SESSION["uName"].'">
							<input type="hidden" name="iid">
							<div class="item-container">
								<label for="iname"><b>物品名称</b></label>
								<input type="text" placeholder="请输入物品名称" name="iname" required>
						
								<label for="idesc"><b>物品说明</b></label>
								<input type="text" placeholder="请输入物品说明" name="idesc" required>
								
								<div class="row-input">
									<div class="column-input">
										<label for="idesc"><b>物品价格（元）</b></label>
										<input type="text" placeholder="请输入物品价格" name="iprice" required>
									</div>
									<div class="column-input">
										<label for="idesc"><b>微信号/QQ号</b></label>
										<input type="text" placeholder="请输入您的微信号/QQ号" name="schatid" required>
									</div>
									<div class="column-input">
										<label for="idesc"><b>电话号码（+86）</b></label>
										<input type="text" placeholder="请输入您的电话号码（+86）" name="sphone" required>
									</div>
								</div>
		
								<button type="itembtn submit" class="itembtn" name="submit">确认</button>
							</div>
							
							<div class="item-container" style="background-color:#f1f1f1">
								<button type="itembtn" onclick="document.getElementById(\'add_product\').style.display=\'none\'" class="cancelbtn">取消</button>
							</div>
						</form>
					</div>';
				}
				else {
					echo '<button type="button" class="btn btn-primary" id="glyphicon-user"><span class="glyphicon glyphicon-user"></span></button>';
					echo '<a href="../index/login.html"> 登录</a> / <a href="../index/register.html">注册</a></p>';
					echo '<p></p>';
				}
				?>
			</div>
			<hr>
			<!--  -->
			
			<!-- 展示所有的二手物品 -->
			<?php
				getItems($connection);
			?>
		</div>
	</div>

	<!-- 上传（物品图片）js函数 -->
	<script src="../js/image_upload.js"></script>
	<script>
		// Get the modal
		var modal = document.getElementById('add_product');
		
		// When the user clicks anywhere outside of the modal, close it
		window.onclick = function(event) {
			if (event.target == modal) {
				modal.style.display = "none";
			}
		}
	</script>
</body>
</html>
